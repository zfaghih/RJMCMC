!!$  #########################################################################
!!$  ############ extreme fast sine hankel transform #########################
!!$  #########################################################################
SUBROUTINE FRTSIN10 (FOMEGA,NF,I)
!!!$ ORGINALLY WRITTEN BY T. HANSTEIN
!!!$ modularised and adaptet by R. Martin
!!!$ coefficients for the filter from T. Hanstein.
! Changes for implementation in Emuplus, End 2002, CS
  USE mar_data
  USE calc_mod
  INTEGER NF,I
  COMPLEX (OP) :: FOMEGA(NF)
!!!$ hankel koeffizienten sind in HS drin
  REAL (OP), DIMENSION(NC_FRT10) :: HS
  INTEGER NN,IT,ITE,ITA,ITN

  DATA HS/ &
       5.001828619748D-11,  8.000316120438D-11,  1.256402544181D-10,&
       2.009588550853D-10,  3.155940502694D-10,  5.047858212426D-10,&
       7.927364123905D-10,  1.267964654328D-09,  1.991263835862D-09,&
       3.184983205351D-09,  5.001828597072D-09,  8.000316063478D-09,&
       1.256402529873D-08,  2.009588514913D-08,  3.155940412418D-08,&
       5.047857985663D-08,  7.927363554301D-08,  1.267964511250D-07,&
       1.991263476466D-07,  3.184982302589D-07,  5.001826329436D-07,&
       8.000310367436D-07,  1.256401099092D-06,  2.009584920955D-06,&
       3.155931384806D-06,  5.047835309338D-06,  7.927306593996D-06,&
       1.267950203486D-05,  1.991227537062D-05,  3.184892027179D-05,&
       5.001599569013D-05,  7.999740775605D-05,  1.256258025926D-04,&
       2.009225544699D-04,  3.155028701506D-04,  5.045567986943D-04,&
       7.921611797863D-04,  1.266519918458D-03,  1.987635552733D-03,&
       3.175872271022D-03,  4.978954515972D-03,  7.942904898046D-03,&
       1.241999775208D-02,  1.973483037551D-02,  3.065536075471D-02,&
       4.821915955197D-02,  7.364349454752D-02,  1.128324990692D-01,&
       1.647498270580D-01,  2.348622073565D-01,  3.004906120931D-01,&
       3.372419544980D-01,  2.337323057571D-01, -8.647107370528D-02,&
       -6.612998838316D-01, -8.142973847232D-01,  3.308580205251D-01,&
       1.402431836112D+00, -1.565115575174D+00,  8.359842529327D-01,&
       -3.059906715040D-01,  9.125029792168D-02, -2.463153043877D-02,&
       6.369876126682D-03, -1.618933642080D-03,  4.085877295949D-04,&
       -1.028279000071D-04,  2.584884062436D-05, -6.494903890100D-06,&
       1.631643159109D-06, -4.098699451225D-07,  1.029566468889D-07,&
       -2.586173749086D-08,  6.496194363419D-09, -1.631772145620D-09,&
       4.098827874303D-10, -1.029578893387D-10,  2.586183686476D-11,&
       -6.496186503931D-12,  1.631760749091D-12/

  DO IT=1,NT_F
     EOUT(I,IT)=0.0
  ENDDO
  DO NN=1,NF
     ITA=MAX0(1,NN-NC_FRT10+1)
     ITE=MIN0(NT_F,NN)
     DO IT=ITA,ITE
        ITN=NC_FRT10-NN+IT
        EOUT(I,IT)=EOUT(I,IT)-AIMAG(FOMEGA(NN))*HS(ITN)
     END DO
  END DO
  DO IT=1,NT_F
     EOUT(I,IT)=EOUT(I,IT)*SQRT2PI/FTIME(IT)
  ENDDO
END SUBROUTINE frtsin10

SUBROUTINE FILTER16(K,NC,NC0,SQROOT,H)      
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
!                                                                     ! 
!      FILTER COEFFICIENTS FOR FAST HANKEL TRANSFORM                  ! 
!      15 or 18 DATA POINTS PER DECADE                                ! 
!      COEFFICIENT H(NC0) REFERS TO ZERO ARGUMENT                     ! 
!      NC=NUMBER OF COEFFICIENTS                                      ! 
!      SQROOT = Stepsize (depending on number of data points per dec. !
!      K=3: Bessel function of order 0 (J0)                           ! 
!      K=4: Bessel function of order 1 (J1)                           ! 
!      K=5: Derivative of J1                                          !
!                                                                     !
!      Coefficients calculated by C. Scholl in 2006                   ! 
!                                                                     ! 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!  
 
  USE mar_data
  INTEGER K,I,N(5),N0(5)
  INTEGER NC, NC0
  REAL (OP) :: H(300),ROOT(5),SQROOT
  REAL (OP) :: J0(208),J1(148),J1P(209)

  DATA N0(3),N(3),ROOT(3),J0/124,208,1.1659144011798317_OP, &
 0.96853059735792E-09, 0.11292713675461E-08, 0.13166189661863E-08, &
 0.15350349272109E-08, 0.17897670101135E-08, 0.20866734137787E-08, &
 0.24329070426181E-08, 0.28365549194430E-08, 0.33072026323087E-08, &
 0.38558808657283E-08, 0.44956245141570E-08, 0.52415221534473E-08, &
 0.61111648778602E-08, 0.71250959530891E-08, 0.83072631377019E-08, &
 0.96855493125885E-08, 0.11292536675390E-07, 0.13166131065411E-07, &
 0.15350573043345E-07, 0.17897427448097E-07, 0.20866899162594E-07, &
 0.24329007202584E-07, 0.28365534289535E-07, 0.33071791688922E-07, &
 0.38558865137110E-07, 0.44956366611718E-07, 0.52415265151584E-07, &
 0.61111707682116E-07, 0.71251005221251E-07, 0.83072601568879E-07, &
 0.96855530191365E-07, 0.11292527526445E-06, 0.13166119788313E-06, &
 0.15350566650778E-06, 0.17897448527858E-06, 0.20866893000362E-06, &
 0.24329010996700E-06, 0.28365543807371E-06, 0.33071797353272E-06, &
 0.38558881663535E-06, 0.44956359588726E-06, 0.52415262890509E-06, &
 0.61111714848037E-06, 0.71251019510889E-06, 0.83072600337257E-06, &
 0.96855526446263E-06, 0.11292527097295E-05, 0.13166117311361E-05, &
 0.15350568972137E-05, 0.17897445067344E-05, 0.20866894346432E-05, &
 0.24329005332922E-05, 0.28365547635782E-05, 0.33071787927131E-05, &
 0.38558891444902E-05, 0.44956343804636E-05, 0.52415277801726E-05, &
 0.61111687187567E-05, 0.71251050277877E-05, 0.83072554868455E-05, &
 0.96855580635597E-05, 0.11292519403511E-04, 0.13166127248450E-04, &
 0.15350555739843E-04, 0.17897462679330E-04, 0.20866871338044E-04, &
 0.24329036392925E-04, 0.28365506656037E-04, 0.33071841709763E-04, &
 0.38558818156756E-04, 0.44956437968521E-04, 0.52415149950051E-04, &
 0.61111853627473E-04, 0.71250822881269E-04, 0.83072844931705E-04, &
 0.96855178836371E-04, 0.11292569938433E-03, 0.13166055760540E-03, &
 0.15350643613111E-03, 0.17897335025448E-03, 0.20867023218768E-03, &
 0.24328807090180E-03, 0.28365766838959E-03, 0.33071426726254E-03, &
 0.38559258125203E-03, 0.44955678904896E-03, 0.52415879180302E-03, &
 0.61110445715974E-03, 0.71251992881939E-03, 0.83070186400910E-03, &
 0.96856952847838E-03, 0.11292056700368E-02, 0.13166296315732E-02, &
 0.15349626482117E-02, 0.17897578310558E-02, 0.20864947219008E-02, &
 0.24328782803267E-02, 0.28361395221839E-02, 0.33070247262376E-02, &
 0.38549761222722E-02, 0.44950747550193E-02, 0.52394636834119E-02, &
 0.61094593929153E-02, 0.71203235304611E-02, 0.83024272606285E-02, &
 0.96742584960997E-02, 0.11279452083055E-01, 0.13138998404658E-01, &
 0.15316085611154E-01, 0.17831541004437E-01, 0.20777419535671E-01, &
 0.24167429800144E-01, 0.28135914303363E-01, 0.32673228842638E-01, &
 0.37974164254240E-01, 0.43969525957287E-01, 0.50935732648255E-01, &
 0.58664889996285E-01, 0.67530170067188E-01, 0.77013966252547E-01, &
 0.87568193435115E-01, 0.98003578790698E-01, 0.10874083585185E+00, &
 0.11719321760364E+00, 0.12348523907861E+00, 0.12237598062013E+00, &
 0.11351473722290E+00, 0.87709400816969E-01, 0.46029261290271E-01, &
-0.22394526761774E-01,-0.10366566108733E+00,-0.19487052607290E+00, &
-0.24000577858325E+00,-0.20778762152807E+00,-0.24876823678836E-01, &
 0.21075638875039E+00, 0.33017240302283E+00, 0.13838890841439E-01, &
-0.35983241068343E+00,-0.77382004046871E-01, 0.46472434763875E+00, &
-0.40880310759139E+00, 0.19746345878399E+00,-0.53336843098421E-01, &
-0.61106961300702E-02, 0.22037171222825E-01,-0.22472463817927E-01, &
 0.18864808418736E-01,-0.14872441200621E-01, 0.11443935186643E-01, &
-0.87142434462373E-02, 0.66031931604962E-02,-0.49912607241654E-02, &
 0.37679497853312E-02,-0.28424679793859E-02, 0.21434720510650E-02, &
-0.16160173073070E-02, 0.12182074232063E-02,-0.91826187399067E-03, &
 0.69214154215683E-03,-0.52169138871928E-03, 0.39321218285394E-03, &
-0.29637199590028E-03, 0.22338067855828E-03,-0.16836547803845E-03, &
 0.12689950329422E-03,-0.95645925596860E-04, 0.72089637767882E-04, &
-0.54334929552477E-04, 0.40952961602947E-04,-0.30866791368021E-04, &
 0.23264709808023E-04,-0.17534919726025E-04, 0.13216300917475E-04, &
-0.99613007245013E-05, 0.75079640103219E-05,-0.56588516863748E-05, &
 0.42651512870092E-05,-0.32147008808836E-05, 0.24229625234430E-05, &
-0.18262188701477E-05, 0.13764452885916E-05,-0.10374449993635E-05, &
 0.78193600517462E-06,-0.58935549494363E-06, 0.44420502951769E-06, &
-0.33480318832059E-06, 0.25234560184880E-06,-0.19019620588452E-06, &
 0.14335339590484E-06,-0.10804734120878E-06, 0.81436725444622E-07, &
-0.61379913533979E-07, 0.46262869871879E-07,-0.34868922630225E-07, &
 0.26281180818154E-07,-0.19808449159111E-07, 0.14929918436248E-07, &
-0.11252858867789E-07, 0.84814486194725E-08,-0.63925483313760E-08, &
 0.48181809215455E-08,-0.36314979587914E-08, 0.27371351378554E-08, &
-0.20629920030449E-08, 0.15549257972903E-08,-0.11719453927742E-08, &
 0.88333095306499E-09 /
  DATA N0(4),N(4),ROOT(4),J1/61,148,1.1659144011798317_OP, &
 0.74001018258360E-09, 0.10798825054462E-08, 0.13697952171426E-08, &
 0.19922380692180E-08, 0.25354677241971E-08, 0.36757172961084E-08, &
 0.46926127505421E-08, 0.67822886273520E-08, 0.86843896078835E-08, &
 0.12515215474024E-07, 0.16070581030977E-07, 0.23095534126294E-07, &
 0.29736762050935E-07, 0.42623033634284E-07, 0.55020778826839E-07, &
 0.78665815056006E-07, 0.10179634791669E-06, 0.14519514057900E-06, &
 0.18832653893896E-06, 0.26800393155362E-06, 0.34839018281559E-06, &
 0.49471189792865E-06, 0.64446093466446E-06, 0.91323918363709E-06, &
 0.11920779072040E-05, 0.16859187423907E-05, 0.22049106480818E-05, &
 0.31124869877864E-05, 0.40780864082223E-05, 0.57464018172820E-05, &
 0.75422581301970E-05, 0.10609634841462E-04, 0.13948447234527E-04, &
 0.19589293770479E-04, 0.25794607508857E-04, 0.36169944922178E-04, &
 0.47698868280857E-04, 0.66785543515075E-04, 0.88197837913955E-04, &
 0.12331437718664E-03, 0.16306766660609E-03, 0.22768044569964E-03, &
 0.30145149989872E-03, 0.42032942080989E-03, 0.55714522284376E-03, &
 0.77580632695782E-03, 0.10293174554439E-02, 0.14312635838529E-02, &
 0.19003239075426E-02, 0.26382154542530E-02, 0.35039460377426E-02, &
 0.48550660863436E-02, 0.64458850317339E-02, 0.89076289427889E-02, &
 0.11807425555697E-01, 0.16250681780287E-01, 0.21458136141914E-01, &
 0.29335131751576E-01, 0.38424541542751E-01, 0.51911100407402E-01, &
 0.66908395823134E-01, 0.88433786393838E-01, 0.11036565017971E+00, &
 0.13977320243330E+00, 0.16305746857072E+00, 0.18852149711423E+00, &
 0.18702962379159E+00, 0.16883345330639E+00, 0.84588383135503E-01, &
-0.27744412905776E-01,-0.20062807178915E+00,-0.27214988075079E+00, &
-0.21849420502282E+00, 0.13656670923291E+00, 0.32459983182254E+00, &
 0.11441627349738E+00,-0.48344427994054E+00, 0.21530864406849E+00, &
 0.14264650257352E+00,-0.26319757043590E+00, 0.22842563101007E+00, &
-0.16215018689887E+00, 0.11024440646441E+00,-0.76107373043719E-01, &
 0.54008211545763E-01,-0.39208738085453E-01, 0.28901442858323E-01, &
-0.21503504113277E-01, 0.16087474780110E-01,-0.12073946406295E-01, &
 0.90782863176519E-02,-0.68330021171533E-02, 0.51460898023143E-02, &
-0.38769486031882E-02, 0.29213678282575E-02,-0.22015568752374E-02, &
 0.16592069222084E-02,-0.12505081266196E-02, 0.94249964048142E-03, &
-0.71036378857870E-03, 0.53540601583258E-03,-0.40354063674176E-03, &
 0.30415307405327E-03,-0.22924383267059E-03, 0.17278395228342E-03, &
-0.13022948207523E-03, 0.98155653143007E-04,-0.73981200581832E-04, &
 0.55760603163002E-04,-0.42027501109282E-04, 0.31676681911414E-04, &
-0.23875133263012E-04, 0.17995003200120E-04,-0.13563071584727E-04, &
 0.10222666217721E-04,-0.77049585751269E-05, 0.58073290693728E-05, &
-0.43770606478504E-05, 0.32990484340307E-05,-0.24865363965177E-05, &
 0.18741353293882E-05,-0.14125605641026E-05, 0.10646655548460E-05, &
-0.80245249868749E-06, 0.60481905396983E-06,-0.45586010276390E-06, &
 0.34358778492578E-06,-0.25896665668838E-06, 0.19518658596938E-06, &
-0.14711470332553E-06, 0.11088230739349E-06,-0.83573449665527E-07, &
 0.62990418072883E-07,-0.47476707040126E-07, 0.35783837273799E-07, &
-0.26970732987541E-07, 0.20328205025621E-07,-0.15321626436178E-07, &
 0.11548133034706E-07,-0.87039557826358E-08, 0.65603137093847E-08, &
-0.49445658773261E-08, 0.37268096570086E-08,-0.28089187956002E-08, &
 0.21171451400788E-08,-0.15956971064506E-08, 0.12027334345329E-08, &
-0.90645462230078E-09 /
  DATA N0(5),N(5),ROOT(5),J1P/142,209,1.1364636663857248_OP, &
 0.93882863563088E-09, 0.10668592891337E-08, 0.12125785841453E-08, &
 0.13780876593462E-08, 0.15661173316552E-08, 0.17797276937784E-08, &
 0.20224850191792E-08, 0.22986005517605E-08, 0.26124041576237E-08, &
 0.29687999402873E-08, 0.33738153022679E-08, 0.38344626531218E-08, &
 0.43575222780505E-08, 0.49522632131754E-08, 0.56280757615046E-08, &
 0.63960817898425E-08, 0.72689238300454E-08, 0.82608524502509E-08, &
 0.93881623676020E-08, 0.10669289224152E-07, 0.12125250466392E-07, &
 0.13779910509321E-07, 0.15660385691160E-07, 0.17797463126347E-07, &
 0.20226136419626E-07, 0.22986253105701E-07, 0.26123075442441E-07, &
 0.29687928250328E-07, 0.33739217766871E-07, 0.38343435835877E-07, &
 0.43575902599694E-07, 0.49522450735424E-07, 0.56280447552641E-07, &
 0.63960686028415E-07, 0.72689007993315E-07, 0.82608386302175E-07, &
 0.93881436083550E-07, 0.10669284997328E-06, 0.12125260576816E-06, &
 0.13779918032211E-06, 0.15660372698633E-06, 0.17797441325116E-06, &
 0.20226142448427E-06, 0.22986282538864E-06, 0.26123076711950E-06, &
 0.29687922471826E-06, 0.33739243651794E-06, 0.38343431583935E-06, &
 0.43575907694932E-06, 0.49522441932222E-06, 0.56280455635689E-06, &
 0.63960695657571E-06, 0.72689007624166E-06, 0.82608413017459E-06, &
 0.93881457602132E-06, 0.10669286863536E-05, 0.12125256910351E-05, &
 0.13779913776730E-05, 0.15660371567193E-05, 0.17797443539009E-05, &
 0.20226147410322E-05, 0.22986281851890E-05, 0.26123074236722E-05, &
 0.29687924689073E-05, 0.33739247759397E-05, 0.38343429094555E-05, &
 0.43575913880886E-05, 0.49522442894854E-05, 0.56280456854460E-05, &
 0.63960693921368E-05, 0.72689004522839E-05, 0.82608412593331E-05, &
 0.93881459927854E-05, 0.10669286815205E-04, 0.12125256754249E-04, &
 0.13779913621047E-04, 0.15660371109686E-04, 0.17797442732465E-04, &
 0.20226146710246E-04, 0.22986280700129E-04, 0.26123072441060E-04, &
 0.29687922129837E-04, 0.33739244037796E-04, 0.38343423815307E-04, &
 0.43575906272454E-04, 0.49522431722861E-04, 0.56280440623567E-04, &
 0.63960670496613E-04, 0.72688970143852E-04, 0.82608361847550E-04, &
 0.93881384654038E-04, 0.10669275749770E-03, 0.12125240546011E-03, &
 0.13779889912188E-03, 0.15660336266349E-03, 0.17797391504166E-03, &
 0.20226071679680E-03, 0.22986170445933E-03, 0.26122910654460E-03, &
 0.29687684675345E-03, 0.33738895500681E-03, 0.38342912232469E-03, &
 0.43575155400792E-03, 0.49521329560733E-03, 0.56278822885530E-03, &
 0.63958295967878E-03, 0.72685484827396E-03, 0.82603246118713E-03, &
 0.93873875818013E-03, 0.10668173605917E-02, 0.12123622831199E-02, &
 0.13777515448999E-02, 0.15656851062542E-02, 0.17792275988586E-02, &
 0.20218563248356E-02, 0.22975149801504E-02, 0.26106734987907E-02, &
 0.29663942853137E-02, 0.33704048809375E-02, 0.38291767190819E-02, &
 0.43500090269201E-02, 0.49411159461001E-02, 0.56117135139205E-02, &
 0.63721008351445E-02, 0.72337265528715E-02, 0.82092264965677E-02, &
 0.93124114116128E-02, 0.10558172088841E-01, 0.11962254629161E-01, &
 0.13540833293032E-01, 0.15309779155532E-01, 0.17283468375319E-01, &
 0.19472919168135E-01, 0.21882931670753E-01, 0.24507815803365E-01, &
 0.27325056968312E-01, 0.30286174974389E-01, 0.33303575916332E-01, &
 0.36232315807011E-01, 0.38844901673848E-01, 0.40798548690869E-01, &
 0.41593212703461E-01, 0.40524659265408E-01, 0.36636014834050E-01, &
 0.28692676105763E-01, 0.15205217016095E-01,-0.54106624363989E-02, &
-0.34464273629136E-01,-0.72187401238056E-01,-0.11645225203466E+00, &
-0.16077151761843E+00,-0.19238981575704E+00,-0.19138916857174E+00, &
-0.13536171325099E+00,-0.12691024843087E-01, 0.14980260192420E+00, &
 0.26425670952094E+00, 0.19969043069997E+00,-0.76904695763708E-01, &
-0.32160753252856E+00,-0.11188060601265E+00, 0.33767120094647E+00, &
 0.79735817443371E-01,-0.41850954819610E+00, 0.37870673841701E+00, &
-0.19148437787768E+00, 0.54859854022629E-01, 0.23914494668057E-02, &
-0.15167095885411E-01, 0.12778984799003E-01,-0.81711069422101E-02, &
 0.47881922714386E-02,-0.27409262630679E-02, 0.15605070694129E-02, &
-0.88711725318345E-03, 0.50406956135393E-03,-0.28637429324361E-03, &
 0.16268832263599E-03,-0.92421262085148E-04, 0.52503130892932E-04, &
-0.29826191211391E-04, 0.16943774521464E-04,-0.96254813075008E-05, &
 0.54680782702938E-05,-0.31063256530533E-05, 0.17646526746500E-05, &
-0.10024702660287E-05, 0.56948691069608E-06,-0.32351619093772E-06, &
 0.18378423413061E-06,-0.10440481589023E-06, 0.59310666195442E-07, &
-0.33693406639775E-07, 0.19140686373737E-07,-0.10873506047208E-07, &
 0.61770570134895E-08,-0.35090837264954E-08, 0.19934718112600E-08, &
-0.11324550177904E-08, 0.64331333281000E-09,-0.36545359264054E-09, &
 0.20760597305756E-09,-0.11794431564629E-09, 0.66987281641759E-10, &
-0.38052531285145E-10, 0.21626416780484E-10,-0.12282878731327E-10, &
 0.69704124023816E-11,-0.39623403541856E-11 /
  NC  = N(K)
  NC0 = N0(K)
  SQROOT = ROOT(K)
  SELECT CASE (K)
  CASE (3)
     DO I=1,NC
        H(I)=J0(I)
     ENDDO
  CASE (4)
     DO I=1,NC
        H(I)=J1(I)
     ENDDO
  CASE (5)
     DO I=1,NC
        H(I)=J1P(I)
     ENDDO
  END SELECT
  RETURN
END SUBROUTINE FILTER16

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
SUBROUTINE SPLIN1N(N,Y,C)                                          
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
!                                                                       
!     CUBIC SPLINE INTERPOLATION FOR N EQUIDISTANT ORDINATES Y(1),...,Y(
!     WITH BOUNDARY CONDITIONS Y'(1)=Y'(N)=0 AT THE ENDPOINTS.          
!     THE OUTPUT ARRAY C(3,N) CONTAINS THE INTERPOLATION COEFFICIENTS TO
!     BE USED IN THE SUBROUTINE SPLIN2. 
!
! Some changes for implementing in EMUPLUS (end 2002), cs
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
  USE mar_para
  IMPLICIT NONE
  INTEGER :: N
  COMPLEX (OP) :: Y(N)
  COMPLEX (OP) :: C(3,N)
  INTEGER :: N1,I,II
  COMPLEX (OP) :: P
    
  N1 = N-1                                                         
  DO I=2,N1                                                      
     C(1,I) = Y(I+1) - 2_OP*Y(I) + Y(I-1)
  END DO
  C(2,1) = 0_OP  
  C(3,1) = 0_OP                                                       
  
  DO I=2,N1                                                      
     P = 4. + C(2,I-1)
     C(2,I) = -1_OP/P                                                      
     C(3,I) = (C(1,I)-C(3,I-1))/P                                        
  END DO
  C(1,N) = 0_OP                                                   
  DO II=2,N1                                                     
     I = N+1-II                                                          
     C(1,I) = C(2,I)*C(1,I+1) + C(3,I)
  END DO
  C(1,1) = 0_OP                                                       
  DO I=1,N1                                                      
     C(2,I) = Y(I+1)-Y(I) - C(1,I+1)+C(1,I)
     C(3,I) = Y(I)-C(1,I)                              
  END DO
  C(3,N) = Y(N)                                                       
  RETURN                                                           
END SUBROUTINE SPLIN1N

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
SUBROUTINE SPLIN2N(N,XINT,X1,X2,C,YINT)                            
!
! Some changes for implementing in EMUPLUS (end 2002), cs
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 
  USE mar_para
  IMPLICIT NONE
  INTEGER :: N
  REAL (OP) :: XINT, X1, X2
  COMPLEX (OP) :: C(3,N)
  COMPLEX (OP) :: YINT 
  INTEGER :: I
  REAL (OP) :: H,P,Q,U
  
  H = (X2-X1)/FLOAT(N-1)                                              
  IF (XINT.LT.X1) THEN 
     P = (XINT-X1)/H                                                     
     YINT = C(2,1)*P + C(3,1)
     RETURN
  ELSEIF (XINT.GE.X2) THEN
     P = (XINT-X2)/H                                                     
     YINT = C(2,N-1)*P + C(3,N)
     RETURN                                                            
  ELSE
     U = (XINT-X1)/H                                                     
     I = 1+INT(U)                                                        
     P = U-I+1                                                           
     Q = 1.-P                                                            
     YINT = C(1,I)*Q**3 + C(1,I+1)*P**3 + C(2,I)*P + C(3,I)
     RETURN
  END IF
END SUBROUTINE SPLIN2N

